language: php

php: 
  - 5.4

build_image: shippable/minv2:beta

before_install:
  - setup_ve
  - export PATH=$HOME/.phpenv/bin:$HOME/.phpenv/extensions:$PATH && eval "$(phpenv init -)"
  - phpenv global $SHIPPABLE_PHP_VERSION
  - php --version
  
before_script: 
  - mysqld_safe 2>&1 > /dev/null &
  - sleep 5
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - mysql -e 'create database if not exists test;'

script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage test.php
